{"version":3,"file":"embla-carousel-wheel-gestures.umd.development.js","sources":["../src/WheelGesturesPlugin.ts"],"sourcesContent":["import EmblaCarousel, { EmblaCarouselType } from 'embla-carousel'\nimport { CreateOptionsType } from 'embla-carousel/components/Options'\nimport { CreatePluginType } from 'embla-carousel/components/Plugins'\nimport WheelGestures, { WheelEventState } from 'wheel-gestures'\n\nexport type WheelGesturesPluginOptions = CreateOptionsType<{\n  wheelDraggingClass: string\n  forceWheelAxis?: 'x' | 'y'\n  target?: Element\n}>\n\ntype WheelGesturesPluginUserOptions = Partial<WheelGesturesPluginOptions>\ntype WheelGesturesPluginType = CreatePluginType<{}, WheelGesturesPluginOptions>\n\nconst defaultOptions: WheelGesturesPluginOptions = {\n  active: true,\n  breakpoints: {},\n  wheelDraggingClass: 'is-wheel-dragging',\n  forceWheelAxis: undefined,\n  target: undefined,\n}\n\nWheelGesturesPlugin.globalOptions = undefined as WheelGesturesPluginUserOptions | undefined\n\nconst __DEV__ = process.env.NODE_ENV !== 'production'\n\nexport function WheelGesturesPlugin(userOptions?: WheelGesturesPluginUserOptions): WheelGesturesPluginType {\n  const optionsHandler = EmblaCarousel.optionsHandler()\n  const optionsBase = optionsHandler.merge(defaultOptions, WheelGesturesPlugin.globalOptions)\n  let options: WheelGesturesPluginType['options']\n\n  let cleanup = () => {}\n\n  function init(embla: EmblaCarouselType) {\n    options = optionsHandler.atMedia(self.options)\n    const engine = embla.internalEngine()\n    const targetNode = options.target ?? (embla.containerNode().parentNode as Element)\n    const wheelAxis = options.forceWheelAxis ?? engine.options.axis\n    const wheelGestures = WheelGestures({\n      preventWheelAction: wheelAxis,\n      reverseSign: [true, true, false],\n    })\n\n    const unobserveTargetNode = wheelGestures.observe(targetNode)\n    const offWheel = wheelGestures.on('wheel', handleWheel)\n\n    let isStarted = false\n    let startEvent: MouseEvent\n\n    function wheelGestureStarted(state: WheelEventState) {\n      try {\n        startEvent = new MouseEvent('mousedown', state.event)\n        dispatchEvent(startEvent)\n      } catch (e) {\n        // Legacy Browsers like IE 10 & 11 will throw when attempting to create the Event\n        if (__DEV__) {\n          console.warn(\n            'Legacy browser requires events-polyfill (https://github.com/xiel/embla-carousel-wheel-gestures#legacy-browsers)'\n          )\n        }\n        return cleanup()\n      }\n\n      isStarted = true\n      addNativeMouseEventListeners()\n\n      if (options.wheelDraggingClass) {\n        targetNode.classList.add(options.wheelDraggingClass)\n      }\n    }\n\n    function wheelGestureEnded(state: WheelEventState) {\n      isStarted = false\n      dispatchEvent(createRelativeMouseEvent('mouseup', state))\n      removeNativeMouseEventListeners()\n\n      if (options.wheelDraggingClass) {\n        targetNode.classList.remove(options.wheelDraggingClass)\n      }\n    }\n\n    function addNativeMouseEventListeners() {\n      document.documentElement.addEventListener('mousemove', preventNativeMouseHandler, true)\n      document.documentElement.addEventListener('mouseup', preventNativeMouseHandler, true)\n      document.documentElement.addEventListener('mousedown', preventNativeMouseHandler, true)\n    }\n\n    function removeNativeMouseEventListeners() {\n      document.documentElement.removeEventListener('mousemove', preventNativeMouseHandler, true)\n      document.documentElement.removeEventListener('mouseup', preventNativeMouseHandler, true)\n      document.documentElement.removeEventListener('mousedown', preventNativeMouseHandler, true)\n    }\n\n    function preventNativeMouseHandler(e: MouseEvent) {\n      if (isStarted && e.isTrusted) {\n        e.stopImmediatePropagation()\n      }\n    }\n\n    function createRelativeMouseEvent(type: 'mousedown' | 'mousemove' | 'mouseup', state: WheelEventState) {\n      let moveX, moveY\n\n      if (wheelAxis === engine.options.axis) {\n        ;[moveX, moveY] = state.axisMovement\n      } else {\n        // if emblas axis and the wheelAxis don't match, swap the axes to match the right embla events\n        ;[moveY, moveX] = state.axisMovement\n      }\n\n      return new MouseEvent(type, {\n        clientX: startEvent.clientX + moveX,\n        clientY: startEvent.clientY + moveY,\n        screenX: startEvent.screenX + moveX,\n        screenY: startEvent.screenY + moveY,\n        movementX: moveX,\n        movementY: moveY,\n        button: 0,\n        bubbles: true,\n        cancelable: true,\n        composed: true,\n      })\n    }\n\n    function dispatchEvent(event: UIEvent) {\n      embla.containerNode().dispatchEvent(event)\n    }\n\n    function handleWheel(state: WheelEventState) {\n      const {\n        axisDelta: [deltaX, deltaY],\n      } = state\n      const primaryAxisDelta = wheelAxis === 'x' ? deltaX : deltaY\n      const crossAxisDelta = wheelAxis === 'x' ? deltaY : deltaX\n      const isRelease = state.isMomentum && state.previous && !state.previous.isMomentum\n      const isEndingOrRelease = (state.isEnding && !state.isMomentum) || isRelease\n      const primaryAxisDeltaIsDominant = Math.abs(primaryAxisDelta) > Math.abs(crossAxisDelta)\n\n      if (primaryAxisDeltaIsDominant && !isStarted && !state.isMomentum) {\n        wheelGestureStarted(state)\n      }\n\n      if (!isStarted) return\n      if (isEndingOrRelease) {\n        wheelGestureEnded(state)\n      } else {\n        dispatchEvent(createRelativeMouseEvent('mousemove', state))\n      }\n    }\n\n    cleanup = () => {\n      unobserveTargetNode()\n      offWheel()\n      removeNativeMouseEventListeners()\n    }\n  }\n\n  const self: WheelGesturesPluginType = {\n    name: 'wheelGestures',\n    options: optionsHandler.merge(optionsBase, userOptions),\n    init,\n    destroy: () => cleanup(),\n  }\n  return self\n}\n"],"names":["defaultOptions","active","breakpoints","wheelDraggingClass","forceWheelAxis","undefined","target","WheelGesturesPlugin","globalOptions","userOptions","optionsHandler","EmblaCarousel","optionsBase","merge","options","cleanup","init","embla","atMedia","self","engine","internalEngine","targetNode","containerNode","parentNode","wheelAxis","axis","wheelGestures","WheelGestures","preventWheelAction","reverseSign","unobserveTargetNode","observe","offWheel","on","handleWheel","isStarted","startEvent","wheelGestureStarted","state","MouseEvent","event","dispatchEvent","e","console","warn","addNativeMouseEventListeners","classList","add","wheelGestureEnded","createRelativeMouseEvent","removeNativeMouseEventListeners","remove","document","documentElement","addEventListener","preventNativeMouseHandler","removeEventListener","isTrusted","stopImmediatePropagation","type","moveX","moveY","axisMovement","clientX","clientY","screenX","screenY","movementX","movementY","button","bubbles","cancelable","composed","axisDelta","deltaX","deltaY","primaryAxisDelta","crossAxisDelta","isRelease","isMomentum","previous","isEndingOrRelease","isEnding","primaryAxisDeltaIsDominant","Math","abs","name","destroy"],"mappings":"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"}